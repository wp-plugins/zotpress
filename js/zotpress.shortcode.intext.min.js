jQuery(document).ready(function(){function l(s,t,c){var e=[];-1!=t.indexOf(";")?e=t.split(";"):e.push(t);var a={};jQuery.each(c,function(t,e){a.hasOwnProperty(e.key)||(a[e.key]=e)}),c=a;var o={};jQuery.each(e,function(t,d){var a="",e=jQuery(s).parent(),r="zp-InText-zp-ID-"+d.replace(/{/g,"-").replace(/}/g,"-").replace(/,/g,"_").replace(/:/g,"-")+"-wp"+jQuery(".ZP_POSTID",s).text(),n=0;1<jQuery("."+r,e).length&&(o.hasOwnProperty(r)?n=o[r]:o[r]=0);var y=JSON.parse(jQuery("."+r+":eq("+n+")",e).attr("rel").replace(/'/g,'"'));intext_citation_split=d.split("},{"),d=new Array,jQuery.each(intext_citation_split,function(t,e){item_parts=e.split(":"),item_pages=!1,"np"!=y.pages&&(item_pages=y.pages.split("--"),"np"==item_pages[t]&&(item_pages[t]=!1),item_pages=item_pages[t]),d[t]={api_user_id:item_parts[0].replace("{",""),key:item_parts[1].replace("}",""),post_id:jQuery(".ZP_POSTID",s).text(),pages:item_pages}});var u=[];jQuery.each(d,function(t,e){var a,r,n,p,i,s="",o="",l="";window.zpIntextCitations["post-"+e.post_id].hasOwnProperty(e.key)||(window.zpIntextCitations["post-"+e.post_id][e.key]=e,void 0===window.zpIntextCitationCount["post-"+e.post_id]&&(window.zpIntextCitationCount["post-"+e.post_id]=0),window.zpIntextCitationCount["post-"+e.post_id]++,window.zpIntextCitations["post-"+e.post_id][e.key].num=window.zpIntextCitationCount["post-"+e.post_id]),c.hasOwnProperty(e.key)&&(c[e.key].data.hasOwnProperty("creators")?(a=0,r=!1,jQuery.each(c[e.key].data.creators,function(t,e){if("author"==e.creatorType)return!(r=!0)}),jQuery.each(c[e.key].data.creators,function(t,e){return!(!r||"author"==e.creatorType)||(a++,0!=t&&1<a&&(o+=", "),void(e.hasOwnProperty("name")?o+=e.name:e.hasOwnProperty("lastName")&&(o+=e.lastName)))}),-1==u.indexOf(o)?u[u.length]=o:o="",o=o.split(", "),jQuery.isArray(o)&&2<o.length&&(""==y.etal||"default"==y.etal||"yes"==y.etal&&(o=o[0]+" <em>et al.</em>")),jQuery.isArray(o)&&1<o.length&&-1==o.indexOf("et al")&&(p=" &amp; ",p="and"==y.and?" and ":"comma-and"==y.and?", and ":"comma-amp"==y.and?", &amp; ":"comma"==y.and?", ":" &amp; ",o=(n=o.join().replace(/,/g,", ")).substring(0,n.lastIndexOf(", "))+p+o[o.length-1])):o+=c[e.key].data.title,l=c[e.key].meta.hasOwnProperty("parsedDate")?c[e.key].meta.parsedDate.substring(0,4):"n.d.",window.zpIntextCitations["post-"+e.post_id][e.key].intexttitle="title='"+JSON.stringify(o).replace("<em>et al.</em>","et al.").replace(/\"/g,"").replace("[","").replace("]","").replace(/â€™/g,"&#39;").replace(/'/g,"&#39;")+" ("+l+"). "+c[e.key].data.title+".' "),-1!=y.format.indexOf("%num%")?(i=y.format,p=window.zpIntextCitations["post-"+e.post_id][e.key].num,s=y.format.replace("%num%",p),s=0!=e.pages?(p="p. ",-1!=e.pages.indexOf("-")&&(p="pp. "),s.replace("%p%",p+e.pages)):s.replace(", %p%",""),1<d.length&&(t!=d.length-1&&(s=s.replace(")","")),0!=t&&(s=""==o?s.replace("(, ",""):s.replace("(",""))),y.brackets&&(s=(s=s.replace("(","")).replace(")",""))):(i=y.format,s=(s=y.format.replace("%a%",o)).replace("%d%",l),s=0==e.pages?(s=s.replace(", %p%","")).replace("%p%",""):s.replace("%p%",e.pages),"(%a%, %d%, %p%)"==i&&1<d.length&&(t!=d.length-1&&(s=s.replace(")","")),0!=t&&(s=""==o?s.replace("(, ",""):s.replace("(","")))),window.zpIntextCitations["post-"+e.post_id][e.key].hasOwnProperty("intexttitle")||(window.zpIntextCitations["post-"+e.post_id][e.key].intexttitle=""),s="<a "+window.zpIntextCitations["post-"+e.post_id][e.key].intexttitle+"class='zp-ZotpressInText' href='#zp-ID-"+e.post_id+"-"+e.api_user_id+"-"+e.key+"'>"+s+"</a>","-1"!=y.format.indexOf("sup")&&(s="<sup>"+s+"</sup>"),d[t].intext=s});var p="";y.brackets&&(p="[");var i="";y.brackets&&(i="]"),a=p,jQuery.each(d,function(t,e){0!=t&&("comma"==y.separator?a+=", ":a+="; "),a+=e.intext}),a+=i,jQuery("."+r+":eq("+n+")",e).removeClass("loading").html(a),o.hasOwnProperty(r)&&o[r]++})}function d(y,u,t,c,h){var z=!1,m=jQuery(".ZP_POSTID",y).text(),g=[],j=[],w=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];if(jQuery.each(u.data,function(t,a){var r="",e=jQuery("#"+u.instance+" .zp-List #zp-ID-"+m+"-"+a.library.id+"-"+a.key),n="0000",p="0000";a.meta.hasOwnProperty("parsedDate")&&(n=a.meta.parsedDate.substring(0,4)),a.data.hasOwnProperty("date")&&(p=a.data.date);var i=a.data.title;a.meta.hasOwnProperty("creatorSummary")&&(i=a.meta.creatorSummary.replace(/ /g,"-")),1==c.zpTitle&&tempTitle!=n&&(tempTitle=n,r+="<h3>"+tempTitle+"</h3>\n");var s=i+"-"+p,o=p;j.push(s);var l,d=j.filter(t=>t===s).length;1<d&&(p+=w[d-1]),r+="<div id='zp-ID-"+jQuery(".ZP_POSTID",y).text()+"-"+a.library.id+"-"+a.key+"'",r+=" data-zp-author-date='"+i+"-"+p+"'",r+=" data-zp-date-author='"+p+"-"+i+"'",r+=" class='zp-Entry zpSearchResultsItem zp-Num-"+window.zpIntextCitations["post-"+m][a.key].num,2==d&&(l=o+w[d-2],u.data[t-1].bib=u.data[t-1].bib.replace(o,l),(n=jQuery("#"+u.instance+" .zp-List .zp-Entry[data-zp-author-date='"+i+"-"+o.replace(" ","-")+"']")).attr("data-zp-author-date",i+"-"+l.replace(" ","-")).attr("data-zp-date-author",p+w[d-2]+"-"+i),jQuery(".csl-entry",n).html(jQuery(".csl-entry",n).html().replace(o,l)),jQuery('a[href="#zp-ID-'+jQuery(".ZP_POSTID",y).text()+"-"+u.data[t-1].library.id+"-"+u.data[t-1].key+'"]').each(function(){this.text=this.text.replace(o,l)})),a.bib=a.bib.replace(o,p),jQuery('a[href="#zp-ID-'+jQuery(".ZP_POSTID",y).text()+"-"+a.library.id+"-"+a.key+'"]').each(function(){this.text=this.text.replace(o,p)}),!0===h&&(r+=" zp_updated"),0<jQuery("#"+u.instance+" .ZP_SHOWIMAGE").text().trim().length&&a.hasOwnProperty("image")?(r+=" zp-HasImage'>\n",r+="<div id='zp-Citation-"+a.key+"' class='zp-Entry-Image hasImage' rel='"+a.key+"'>\n","image"==c.zpURLWrap&&""!=a.data.url&&(r+="<a href='"+a.data.url+"'",c.zpTarget&&(r+=" target='_blank'"),r+=">"),r+="<img class='thumb' src='"+a.image[0]+"' alt='image' />\n","image"==c.zpURLWrap&&""!=a.data.url&&(r+="</a>"),r+="</div>\x3c!-- .zp-Entry-Image --\x3e\n"):r+="'>\n";t=function(t,e,a){var r={order:0,item_key:""};{var n,p;/csl-left-margin/i.test(e.bib)?(p=jQuery.parseHTML(e.bib),n=(n=jQuery(".csl-left-margin",p).text()).replace(n.match(/\d+/)[0],window.zpIntextCitations["post-"+a][e.key].num),jQuery(".csl-left-margin",p).text(n),e.bib=jQuery("<div>").append(p).html(),r.order=window.zpIntextCitations["post-"+a][e.key].num,r.key=e.key):0<jQuery("#"+t+" .ZP_FORCENUM").text().length&&"1"==jQuery("#"+t+" .ZP_FORCENUM").text()&&(p=jQuery.parseHTML(e.bib),jQuery(".csl-entry",p).prepend('<div class="csl-left-margin" style="display: inline;">'+window.zpIntextCitations["post-"+a][e.key].num+". </div>"),e.bib=jQuery("<div>").append(p).html(),r.order=window.zpIntextCitations["post-"+a][e.key].num,r.key=e.key)}return{itemNumOrder:r,item:e}}(u.instance,a,m);a=t.item,g[t.itemNumOrder.order]=t.itemNumOrder.key,/csl-left-margin/i.test(a.bib)&&(z=!0),r+=a.bib,1==c.zpShowAbstracts&&a.data.hasOwnProperty("abstractNote")&&0<a.data.abstractNote.length&&(r+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+a.data.abstractNote+"</p>\n"),1==c.zpShowTags&&a.data.hasOwnProperty("tags")&&0<a.data.tags.length&&(r+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ",jQuery.each(a.data.tags,function(t,e){r+="<span class='tag'>"+e.tag+"</span>",t!=a.data.tags.length-1&&(r+="<span class='separator'>,</span> ")}),r+="</p>\n"),r+="</div>\n",1==c.zpShowNotes&&a.hasOwnProperty("notes")&&(tempNotes+=a.notes),!(0<e.length&&!0===h)&&0==e.length?jQuery("#"+u.instance+" .zp-List").append(r):e.replaceWith(jQuery(r))}),z&&!1===h&&0!=jQuery("#"+u.instance+" .zp-List .zp-Entry").length)for(var e=1;e<g.length;e++){window.zpIntextCitations["post-"+m][g[e]];var a=jQuery("#zp-ID-"+m+"-"+window.zpIntextCitations["post-"+m][g[e]].api_user_id+"-"+g[e]);jQuery("#"+u.instance+" .zp-List").append(a)}}0<jQuery(".zp-Zotpress-InTextBib").length&&(window.zpIntextCitations={},window.zpIntextCitationCount={},jQuery(".zp-Zotpress-InTextBib").each(function(t,e){var a=jQuery(e),e={};window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",a).text()]={},e.zpItemkey=!1,0<jQuery(".ZP_ITEM_KEY",a).text().trim().length&&(e.zpItemkey=jQuery(".ZP_ITEM_KEY",a).text()),e.zpStyle=!1,0<jQuery(".ZP_STYLE",a).text().trim().length&&(e.zpStyle=jQuery(".ZP_STYLE",a).text()),e.zpTitle=!1,0<jQuery(".ZP_TITLE",a).text().trim().length&&(e.zpTitle=jQuery(".ZP_TITLE",a).text()),e.zpShowImages=!1,0<jQuery(".ZP_SHOWIMAGE",a).text().trim().length&&(e.zpShowImages=jQuery(".ZP_SHOWIMAGE",a).text().trim()),e.zpShowTags=!1,0<jQuery(".ZP_SHOWTAGS",a).text().trim().length&&(e.zpShowTags=!0),e.zpDownloadable=!1,0<jQuery(".ZP_DOWNLOADABLE",a).text().trim().length&&(e.zpDownloadable=!0),e.zpShowNotes=!1,0<jQuery(".ZP_NOTES",a).text().trim().length&&(e.zpShowNotes=!0),e.zpShowAbstracts=!1,0<jQuery(".ZP_ABSTRACT",a).text().trim().length&&(e.zpShowAbstracts=!0),e.zpCiteable=!1,0<jQuery(".ZP_CITEABLE",a).text().trim().length&&(e.zpCiteable=!0),e.zpTarget=!1,0<jQuery(".ZP_TARGET",a).text().trim().length&&(e.zpTarget=!0),e.zpURLWrap=!1,0<jQuery(".ZP_URLWRAP",a).text().trim().length&&(e.zpURLWrap=jQuery(".ZP_URLWRAP",a).text()),e.zpHighlight=!1,0<jQuery(".ZP_HIGHLIGHT",a).text().trim().length&&(e.zpHighlight=jQuery(".ZP_HIGHLIGHT",a).text()),e.zpSortBy=!1,0<jQuery(".ZP_SORTBY",a).text().trim().length&&(e.zpSortBy=jQuery(".ZP_SORTBY",a).text()),e.zpOrder=!1,0<jQuery(".ZP_ORDER",a).text().trim().length&&(e.zpOrder=jQuery(".ZP_ORDER",a).text()),function p(t,e,i,s,o){void 0!==t&&"false"!=t&&""!=t||(t=0);void 0!==e&&"false"!=e&&""!=e||(e=0);jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",instance_id:i.attr("id"),type:"intext",item_key:s.zpItemkey,style:s.zpStyle,title:s.zpTitle,showimage:s.zpShowImages,showtags:s.zpShowTags,downloadable:s.zpDownloadable,shownotes:s.zpShowNotes,showabstracts:s.zpShowAbstracts,citeable:s.zpCiteable,target:s.zpTarget,urlwrap:s.zpURLWrap,highlight:s.zpHighlight,sortby:s.zpSortBy,order:s.zpOrder,update:o,request_start:t,request_last:e,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(t){var e,a,r,n=jQuery.parseJSON(t);"error"==n.status?(console.log("Zotpress Error: "+n.data),t="",0<jQuery("#"+n.instance+" .zp-List .zp-Entry").length&&(t=' class="hide"'),jQuery("#"+n.instance+" .zp-List").removeClass("loading").append("<p"+t+">Zotpress Error: "+n.data+"</p>")):void 0!==n&&null!=n&&0!=parseInt(n)&&0<n.data.length?(1==s.zpShowNotes&&(e=""),s.zpTitle,jQuery(i).parent(),!1===o?jQuery("#"+n.instance+" .zp-List").addClass("used_cache"):!0===o&&(!jQuery("#"+n.instance+" .zp-List").hasClass("updating")&&0<jQuery("#"+n.instance+" .zp-Citation-Notes").length&&jQuery("#"+n.instance+" .zp-Citation-Notes").remove(),jQuery("#"+n.instance+" .zp-List").hasClass("updating")||jQuery("#"+n.instance+" .zp-List").addClass("updating")),l(i,s.zpItemkey,n.data),d(i,n,s.zpItemkey,s,o),!1===o&&jQuery("#"+n.instance+" .zp-SEO-Content .zp-Entry").unwrap(),1==s.zpShowNotes&&0<e.length&&(e="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+e,e+="</ol>\n</div>\x3c!-- .zp-Citation-Notes --\x3e\n\n",jQuery("#"+n.instance).append(e)),0!=n.meta.request_next&&"false"!=n.meta.request_next?p(n.meta.request_next,n.meta.request_last,i,s,o):(jQuery("#"+n.instance+" .zp-List").removeClass("loading"),jQuery("#"+n.instance+" .zp-List").hasClass("updating")?(e=s.zpSortBy,a=s.zpOrder,-1!==["author","date"].indexOf(e)&&0==jQuery("#"+n.instance+" .zp-List .csl-left-margin").length&&(r="date"==e?"zp-date-author":"zp-author-date",jQuery("#"+n.instance+" .zp-List div.zp-Entry").sort(function(t,e){var t=jQuery(t).data(r).toLowerCase(),e=jQuery(e).data(r).toLowerCase();return e<t?"asc"==a?1:-1:t<e?"asc"==a?-1:1:0}).detach().appendTo("#"+n.instance+" .zp-List"))):p(0,0,i,s,!0))):(n=(n=i.attr("class")).replace("zp-Zotpress zp-Zotpress-InTextBib zp-Post-",""),(0<jQuery("#post-"+n).length?jQuery("#post-"+n+" .zp-InText-Citation"):jQuery("#"+i.attr("id")).parent().find(".zp-InText-Citation")).removeClass("loading").remove(),jQuery("#"+i.attr("id")+" .zp-List").removeClass("loading"),jQuery("#"+i.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n"))},error:function(t){console.log("Zotpress Error:"+t)}})}(0,0,a,e,!1)}))});
