jQuery(document).ready(function(){if(jQuery(".zp-Browse").length>0)for(let s=0;s<window.zpBrowseList.length;++s){var e=jQuery("#"+window.zpBrowseList[s].id),t={zpCollectionId:!1,zpTagId:!1,zpShowTags:!1,zpShowImages:!1,zpIsAdmin:!1,zpTarget:!1,zpTopLevel:!1,zpURLWrap:!1,zpItemsFlag:!0};jQuery(".ZP_COLLECTION_ID",e).length>0&&(t.zpCollectionId=jQuery(".ZP_COLLECTION_ID",e).text()),jQuery(".ZP_TAG_ID",e).length>0&&(t.zpTagId=jQuery(".ZP_TAG_ID",e).text()),jQuery(".ZP_SHOWTAGS").length>0&&"1"==parseInt(jQuery(".ZP_SHOWTAGS").text())&&(t.zpShowTags=!0),jQuery(".ZP_SHOWIMAGE",e).length>0&&("yes"==jQuery(".ZP_SHOWIMAGE",e).text()||"true"==jQuery(".ZP_SHOWIMAGE",e).text()||"1"==jQuery(".ZP_SHOWIMAGE",e).text())&&(t.zpShowImages=!0),jQuery(".ZP_ISADMIN",e).length>0&&(t.zpIsAdmin=!0),jQuery(".ZP_TARGET",e).length>0&&jQuery(".ZP_TARGET").text().length>0&&(t.zpTarget=!0),jQuery(".ZP_TOPLEVEL",e).length>0&&(t.zpTopLevel=jQuery(".ZP_TOPLEVEL",e).text(),!1===t.zpCollectionId&&!1===t.zpTagId&&(t.zpCollectionId=t.zpTopLevel)),jQuery(".ZP_URLWRAP",e).length>0&&(t.zpURLWrap=jQuery(".ZP_URLWRAP",e).text());var a=!0;""==jQuery(".ZP_BROWSEBAR",e).text()&&(a=!1),a&&(r(s,t,e,0,0,!1),o(s,t,e,0,0,!1)),l(s,t,e,0,0,!1)}function s(e){if(0!=jQuery("div.zp-List .csl-left-margin",e).length&&/\d/.test(jQuery("div.zp-List .csl-left-margin",e).text())){var t=1;jQuery("div.zp-List .csl-left-margin",e).each(function(){jQuery(this).text(jQuery(this).text().replace(/(\d+)/,t)),t++})}}function r(e,t,a,s,o,l){void 0!==s&&"false"!=s&&""!=s||(s=0),void 0!==o&&"false"!=o&&""!=o||(o=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery(".ZP_API_USER_ID",a).text(),item_type:"collections",collection_id:t.zpCollectionId,request_start:s,request_last:o,sortby:"title",get_top:!0,update:l,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(s){var o=jQuery.parseJSON(s),n="";!1===l&&jQuery("select.zp-Browse-Collections-Select",a).addClass("used_cache"),!0!==l||jQuery("select.zp-Browse-Collections-Select",a).hasClass("updating")||(jQuery("select.zp-Browse-Collections-Select",a).find("*").not(".blank").remove(),jQuery("select.zp-Browse-Collections-Select",a).addClass("updating"),t.zpTagId&&jQuery("select.zp-Browse-Collections-Select",a).append("<option value='blank'>--"+zpShortcodeAJAX.txt_nocollsel+"--</option>")),t.zpCollectionId&&0==jQuery(".zp-Browse-Collections-Select option.blank",a).length&&jQuery(".ZP_COLLECTION_NAME",a).length>0&&jQuery("select.zp-Browse-Collections-Select",a).append("<option value='blank' class='blank'>"+jQuery(".ZP_COLLECTION_NAME",a).text()+"</option>\n"),"0"!=o&&o.data.length>0&&"0"!=o.data&&(jQuery.each(o.data,function(e,a){var s="<option value='"+a.key+"'";t.zpCollectionId==a.key&&(s+=" selected='selected'"),s+=">",t.zpCollectionId&&(s+="- "),s+=a.data.name+" (",a.meta.numCollections>0&&(s+=a.meta.numCollections+" "+zpShortcodeAJAX.txt_subcoll+", "),s+=a.meta.numItems+" "+zpShortcodeAJAX.txt_items+")</option>\n",n+=s}),jQuery("select.zp-Browse-Collections-Select",a).append(n),0!=o.meta.request_next&&"false"!=o.meta.request_next?r(e,t,a,o.meta.request_next,o.meta.request_last,l):jQuery("select.zp-Browse-Collections-Select",a).hasClass("updating")||r(e,t,a,0,0,!0)),t.zpCollectionId&&"toplevel"!=t.zpCollectionId&&0==jQuery(".zp-Browse-Collections-Select option.toplevel",a).length&&jQuery("select.zp-Browse-Collections-Select",a).append("<option value='toplevel' class='toplevel'>&larr; "+zpShortcodeAJAX.txt_backtotop+"</option>\n"),jQuery("select.zp-Browse-Collections-Select",a).removeClass("loading").find(".loading").remove()},error:function(e){console.log("Error for zplib_get_collections(): ",e.statusText)},complete:function(e,t){}})}function o(e,t,a,s,r,l){void 0!==s&&"false"!=s&&""!=s||(s=0),void 0!==r&&"false"!=r&&""!=r||(r=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery(".ZP_API_USER_ID",a).text(),item_type:"tags",is_dropdown:!0,maxtags:jQuery(".ZP_MAXTAGS",a).text(),request_start:s,request_last:r,update:l,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(s){var r=jQuery.parseJSON(s),n="<option class='zp-List-Tags-Select' name='zp-List-Tags-Select'>--"+zpShortcodeAJAX.txt_notagsel+"--</option>\n";t.zpTagId&&(n="<option value='toplevel' class='toplevel'>--"+zpShortcodeAJAX.txt_unsettag+"--</option>\n"),!1===l&&jQuery("select.zp-List-Tags",a).addClass("used_cache"),!0!==l||jQuery("select.zp-List-Tags",a).hasClass("updating")||jQuery("select.zp-List-Tags",a).empty().addClass("updating"),0!==r&&r.data.length>0?(jQuery.each(r.data,function(e,t){var s="<option class='zp-List-Tag' value='"+t.tag.replace(/ /g,"+")+"'";jQuery(".ZP_TAG_ID",a).length>0&&jQuery(".ZP_TAG_ID",a).text()==t.tag&&(s+=" selected='selected'"),s+=">"+t.tag+" ("+t.meta.numItems+" "+zpShortcodeAJAX.txt_items+")</option>\n",n+=s}),jQuery("select.zp-List-Tags",a).append(n),0!=r.meta.request_next&&"false"!=r.meta.request_next?o(e,t,a,r.meta.request_next,r.meta.request_last,l):jQuery("select.zp-List-Tags",a).hasClass("updating")||o(e,t,a,0,0,!0),jQuery("select.zp-List-Tags",a).removeClass("loading").find(".loading").remove()):(jQuery("select.zp-List-Tags",a).removeClass("loading").find(".loading").remove(),jQuery("select.zp-List-Tags",a).append("<option rel='empty' value='empty'>"+zpShortcodeAJAX.txt_notags+"</option>"))},error:function(e){console.log("Error for zplib_get_tags(): ",e.statusText)},complete:function(e,t){}})}function l(e,t,a,r,o,n){void 0!==r&&"false"!=r&&""!=r||(r=0),void 0!==o&&"false"!=o&&""!=o||(o=0),jQuery(".zp-List",a).hasClass("loading")&&""==jQuery(".zp-List",a).find(".zp_display_progress").text()&&jQuery(".zp-List",a).append("<div class='zp_display_progress'>"+zpShortcodeAJAX.txt_loading+" ...</div>"),jQuery.ajax({async:!0,url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery(".ZP_API_USER_ID",a).text(),is_dropdown:!0,item_type:"items",citeable:jQuery(".ZP_CITEABLE",a).text(),downloadable:jQuery(".ZP_DOWNLOADABLE",a).text(),showtags:t.zpShowTags,showimage:t.zpShowImages,target:t.zpTarget,urlwrap:t.zpURLWrap,collection_id:t.zpCollectionId,tag_id:t.zpTagId,get_top:!0,sortby:jQuery(".ZP_SORTBY",a).text(),order:jQuery(".ZP_ORDER",a).text(),update:n,request_start:r,request_last:o,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(o){var i=jQuery.parseJSON(o);if(!1===n?jQuery(".zp-List",a).addClass("used_cache"):!0===n&&(jQuery(".zp-List",a).hasClass("updating")||jQuery(".zp-List",a).addClass("updating")),void 0!==i&&null!=i&&0!=i&&i.data.length>0&&0!=i.data){var p="";if(jQuery(".zp-List",a).hasClass("updating")||!1===i.meta.request_last||"false"==i.meta.request_last||0===i.meta.request_last||jQuery(".zp-List",a).find(".zp_display_progress").html("Loading "+i.meta.request_next+"-"+(i.meta.request_next+50)+" out of "+(parseInt(i.meta.request_last)+50)+"..."),0!=i.data&&jQuery.each(i.data,function(e,s){var r="",o=jQuery("div.zp-List .zp-ID-"+s.library.id+"-"+s.key,a),l="0000";s.meta.hasOwnProperty("parsedDate")&&(l=s.meta.parsedDate.substring(0,4));var i=s.data.title;s.meta.hasOwnProperty("creatorSummary")&&(i=s.meta.creatorSummary.replace(/ /g,"-")),r+="<div id='zp-ID-"+s.library.id+"-"+s.key+"' class='zp-Entry zpSearchResultsItem hidden",!0===n&&(r+=" zp_updated"),r+="' data-zp-author-year='"+i+"-"+l+"'",r+="' data-zp-year-author='"+l+"-"+i+"'",r+=">\n",(t.zpIsAdmin||t.zpShowImages&&s.hasOwnProperty("image"))&&(r+="<div id='zp-Citation-"+s.key+"' class='zp-Entry-Image",s.hasOwnProperty("image")&&(r+=" hasImage"),r+="' rel='"+s.key+"'>\n",s.hasOwnProperty("image")&&(r+="<img class='thumb' src='"+s.image[0]+"' alt='image' />\n"),t.zpIsAdmin&&(s.hasOwnProperty("image")?r+="<a title='Change Image' class='upload' rel='"+s.key+"' href='#'>"+zpShortcodeAJAX.txt_changeimg+"</a>\n":r+="<a title='Set Image' class='upload' rel='"+s.key+"' href='#'>"+zpShortcodeAJAX.txt_setimg+"</a>\n"),t.zpIsAdmin&&s.hasOwnProperty("image")&&(r+="<a title='"+zpShortcodeAJAX.txt_removeimg+"' class='delete' rel='"+s.key+"' href='#'>&times;</a>\n"),r+="</div>\x3c!-- .zp-Entry-Image --\x3e\n"),r+=s.bib,t.zpShowTags&&s.data.tags.length>0&&(r+="<span class='item_key'>Tag(s): ",jQuery.each(s.data.tags,function(e,t){0!=e&&(r+=", "),r+=t.tag})),t.zpIsAdmin&&(r+="<label for='item_key'>"+zpShortcodeAJAX.txt_itemkey+":</label><input type='text' name='item_key' class='item_key' value='"+s.key+"'>\n"),r+="</div>\x3c!-- .zp-Entry --\x3e\n",o.length>0&&!0===n?o.replaceWith(jQuery(r)):p+=r}),!1===n&&jQuery(".zpSearchResultsContainer",a).append(p),0!=i.meta.request_next&&"false"!=i.meta.request_next)1==t.zpItemsFlag?window.zpBrowseList[e].paginate(t.zpItemsFlag,!1):window.zpBrowseList[e].paginate(t.zpItemsFlag,!0),t.zpItemsFlag=!1,0==r&&i.meta.request_last>0&&0==jQuery(".zpSearchResultsPagingScroller",a).length&&(jQuery(".zpSearchResultsPagingContainerInner",a).append('<div class="zpSearchResultsPagingScroller"><span class="zpSearchResultsPagingBack">&#8249;</span><span class="zpSearchResultsPagingForward">&#8250;</span></div>'),jQuery(".zpSearchResultsPagingContainer",a).on("click",".zpSearchResultsPagingBack",function(){var e=parseInt(jQuery(".zpSearchResultsPaging",a).css("left")),t=parseInt(jQuery(".zpSearchResultsPaging a.selected",a).css("width"))+2*parseInt(jQuery(".zpSearchResultsPaging a.selected",a).css("border-left-width"));0!=e&&jQuery(".zpSearchResultsPaging",a).css("left",e+t+"px")}),jQuery(".zpSearchResultsPagingContainer",a).on("click",".zpSearchResultsPagingForward",function(){var e=parseInt(jQuery(".zpSearchResultsPaging",a).css("left")),t=parseInt(jQuery(".zpSearchResultsPaging a.selected",a).css("width"))+2*parseInt(jQuery(".zpSearchResultsPaging a.selected",a).css("border-left-width"));-1*e<jQuery(".zpSearchResultsPaging",a).width()-50&&jQuery(".zpSearchResultsPaging",a).css("left",e-t+"px")})),s(a),l(e,t,a,i.meta.request_next,i.meta.request_last,n);else if(window.zpBrowseList[e].paginate(t.zpItemsFlag),t.zpItemsFlag=!1,jQuery(".zp-List",a).removeClass("loading"),jQuery(".zp-List",a).find(".zp_display_progress").remove(),jQuery(".zp-List",a).hasClass("updating")){var u=jQuery(".ZP_SORTBY",a).text(),c=jQuery(".ZP_ORDER",a).text();if(-1!==["author","date"].indexOf(u)&&0==jQuery("div.zp-List .csl-left-margin",a).length){var d="data-zp-author-year";"date"==u&&(d="data-zp-year-author"),jQuery("#"+i.instance+" .zp-List div.zp-Entry",a).sort(function(e,t){var a=e.getAttribute(d).toLowerCase(),s=t.getAttribute(d).toLowerCase();return a>s?"asc"==c?1:-1:a<s?"asc"==c?-1:1:0}).detach().appendTo("#"+i.instance+" .zp-List",a)}s(a)}else l(e,t,a,0,0,!0)}else jQuery(".zp-List",a).removeClass("loading"),jQuery(".zp-List",a).find(".zp_display_progress").remove(),jQuery(".zpSearchResultsContainer",a).append("<p>"+zpShortcodeAJAX.txt_nocitations+"</p>\n")},error:function(e){console.log("Error for zplib_get_items(): ",e.statusText)}})}});
