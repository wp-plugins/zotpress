jQuery(document).ready(function(){if(jQuery(".zp-Zotpress-Bib").length>0){var t={},e=0;jQuery(".zp-Zotpress-Bib").each(function(e,i){var n=jQuery(i),s={};if(s.zpItemkey=!1,jQuery(".ZP_ITEM_KEY",n).text().trim().length>0&&(s.zpItemkey=jQuery(".ZP_ITEM_KEY",n).text()),s.zpItemType=!1,jQuery(".ZP_ITEMTYPE",n).text().trim().length>0&&(s.zpItemType=jQuery(".ZP_ITEMTYPE",n).text()),s.zpCollectionId=!1,jQuery(".ZP_COLLECTION_ID",n).text().trim().length>0&&(s.zpCollectionId=jQuery(".ZP_COLLECTION_ID",n).text()),s.zpTagId=!1,jQuery(".ZP_TAG_ID",n).text().trim().length>0&&(s.zpTagId=jQuery(".ZP_TAG_ID",n).text()),s.zpAuthor=!1,jQuery(".ZP_AUTHOR",n).text().trim().length>0&&(s.zpAuthor=jQuery(".ZP_AUTHOR",n).text()),s.zpYear=!1,jQuery(".ZP_YEAR",n).text().trim().length>0&&(s.zpYear=jQuery(".ZP_YEAR",n).text()),s.zpStyle=!1,jQuery(".ZP_STYLE",n).text().trim().length>0&&(s.zpStyle=jQuery(".ZP_STYLE",n).text()),s.zpLimit=!1,jQuery(".ZP_LIMIT",n).text().trim().length>0&&(s.zpLimit=jQuery(".ZP_LIMIT",n).text()),s.zpTitle=!1,jQuery(".ZP_TITLE",n).text().trim().length>0&&(s.zpTitle=jQuery(".ZP_TITLE",n).text()),s.zpShowImages=!1,jQuery(".ZP_SHOWIMAGE",n).text().trim().length>0&&(s.zpShowImages=jQuery(".ZP_SHOWIMAGE",n).text().trim()),s.zpShowTags=!1,jQuery(".ZP_SHOWTAGS",n).text().trim().length>0&&(s.zpShowTags=!0),s.zpDownloadable=!1,jQuery(".ZP_DOWNLOADABLE",n).text().trim().length>0&&(s.zpDownloadable=!0),s.zpInclusive=!1,jQuery(".ZP_INCLUSIVE",n).text().trim().length>0&&(s.zpInclusive=!0),s.zpShowNotes=!1,jQuery(".ZP_NOTES",n).text().trim().length>0&&(s.zpShowNotes=!0),s.zpShowAbstracts=!1,jQuery(".ZP_ABSTRACT",n).text().trim().length>0&&(s.zpShowAbstracts=!0),s.zpCiteable=!1,jQuery(".ZP_CITEABLE",n).text().trim().length>0&&(s.zpCiteable=!0),s.zpTarget=!1,jQuery(".ZP_TARGET",n).text().trim().length>0&&(s.zpTarget=!0),s.zpURLWrap=!1,jQuery(".ZP_URLWRAP",n).text().trim().length>0&&(s.zpURLWrap=jQuery(".ZP_URLWRAP",n).text()),s.zpHighlight=!1,jQuery(".ZP_HIGHLIGHT",n).text().trim().length>0&&(s.zpHighlight=jQuery(".ZP_HIGHLIGHT",n).text()),s.zpForceNumsCount=1,s.zpBibIndex=e,s.zpCollectionId&&-1!=s.zpCollectionId.indexOf(","))t[e]=s.zpCollectionId.split(","),s.zpCollectionId=t[e][0],a(0,0,n,s,!1);else if(s.zpTagId&&!0==s.zpInclusive&&-1!=s.zpTagId.indexOf(",")){var p=s.zpTagId.split(",");jQuery.each(p,function(t,e){s.zpTagId=e,a(0,0,n,s,!1)})}else if(s.zpAuthor&&-1!=s.zpAuthor.indexOf(",")){var r=s.zpAuthor.split(",");!0==s.zpInclusive?jQuery.each(r,function(t,e){s.zpAuthor=e,a(0,0,n,s,!1)}):a(0,0,n,s,!1)}else if(s.zpYear&&-1!=s.zpYear.indexOf(",")){var o=s.zpYear.split(",");jQuery.each(o,function(t,e){s.zpYear=e,a(0,0,n,s,!1)})}else a(0,0,n,s,!1)})}function a(n,s,p,r,o){(void 0===n||"false"==n||""==n)&&(n=0),(void 0===s||"false"==s||""==s)&&(s=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",instance_id:p.attr("id"),api_user_id:jQuery(".ZP_API_USER_ID",p).text(),item_type:jQuery(".ZP_ITEM_TYPE",p).text(),item_key:r.zpItemkey,itemtype:r.zpItemType,collection_id:r.zpCollectionId,tag_id:r.zpTagId,author:encodeURI(r.zpAuthor).replace("'","%27"),year:r.zpYear,style:r.zpStyle,limit:r.zpLimit,title:r.zpTitle,showimage:r.zpShowImages,showtags:r.zpShowTags,downloadable:r.zpDownloadable,inclusive:r.zpInclusive,shownotes:r.zpShowNotes,showabstracts:r.zpShowAbstracts,citeable:r.zpCiteable,target:r.zpTarget,urlwrap:r.zpURLWrap,highlight:r.zpHighlight,sortby:jQuery(".ZP_SORTBY",p).text(),order:jQuery(".ZP_ORDER",p).text(),update:o,request_start:n,request_last:s,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(n){var s=jQuery.parseJSON(n);if(o||(e+=s.data.length),o&&console.log("zp: checking for updates ..."),o?console.log("zp: updating items",s.data.length):console.log("zp: adding items",s.data.length),console.log("zp: total items so far",e),"empty"==s.status||"Not found"==s.data){var l=zpShortcodeAJAX.txt_zperror+" ";0==s.data?(s.data=zpShortcodeAJAX.txt_noitemsfound,l=s.data):l+=s.data,console.log("Zotpress: "+l);var z="";jQuery("#"+s.instance+" .zp-List .zp-Entry").length>0&&(z=' class="hide"'),jQuery("#"+s.instance+" .zp-List").removeClass("loading").append("<p"+z+">"+l+"</p>")}else if(jQuery("#"+s.instance+" .zp-SEO-Content").remove(),void 0!==s&&null!=s&&0!=s&&s.data.length>0){var c="";if(!0==r.zpShowNotes)var d="";!1===o?jQuery("#"+s.instance+" .zp-List").addClass("used_cache"):!0===o&&(!jQuery("#"+s.instance+" .zp-List").hasClass("updating")&&jQuery("#"+s.instance+" .zp-Citation-Notes").length>0&&jQuery("#"+s.instance+" .zp-Citation-Notes").remove(),jQuery("#"+s.instance+" .zp-List").hasClass("updating")||jQuery("#"+s.instance+" .zp-List").addClass("updating"),r.zpForceNumsCount=1),0!=s.data&&jQuery.each(s.data,function(t,e){var a="",i=jQuery("#"+s.instance+" .zp-List #zp-ID-"+jQuery(".ZP_POSTID",p).text()+"-"+jQuery(".ZP_API_USER_ID",p).text()+"-"+e.key);if(i.length>0&&!1===o&&!jQuery("#"+s.instance+" .zp-List").hasClass("used_cache"))return!1;var n="none";e.data.hasOwnProperty("itemType")&&(n=e.data.itemType);var l="0000",z="0000";e.meta.hasOwnProperty("parsedDate")&&(l=e.meta.parsedDate.substring(0,4),z=e.meta.parsedDate);var h=e.data.title;e.meta.hasOwnProperty("creatorSummary")&&(h=e.meta.creatorSummary.replace(/ /g,"-")),a+="<div id='zp-ID-"+jQuery(".ZP_POSTID",p).text()+"-"+jQuery(".ZP_API_USER_ID",p).text()+"-"+e.key+"'",a+=" data-zp-author-date='"+h+"-"+z+"'",a+=" data-zp-date-author='"+z+"-"+h+"'",a+=" data-zp-date='"+z+"'",a+=" data-zp-year='"+l+"'",a+=" data-zp-itemtype='"+n+"'",a+=" class='zp-Entry zpSearchResultsItem",!0===o&&(a+=" zp_updated"),jQuery("#"+s.instance+" .ZP_SHOWIMAGE").text().trim().length>0&&e.hasOwnProperty("image")?(a+=" zp-HasImage'>\n",a+="<div id='zp-Citation-"+e.key+"' class='zp-Entry-Image hasImage' rel='"+e.key+"'>\n","image"==r.zpURLWrap&&""!=e.data.url&&(a+="<a href='"+e.data.url+"'",r.zpTarget&&(a+=" target='_blank'"),a+=">"),a+="<img class='thumb' src='"+e.image[0]+"' alt='image' />\n","image"==r.zpURLWrap&&""!=e.data.url&&(a+="</a>"),a+="</div>\n"):a+="'>\n",jQuery("#"+s.instance+" .ZP_FORCENUM").text().length>0&&"1"==jQuery("#"+s.instance+" .ZP_FORCENUM").text()&&!/csl-left-margin/i.test(e.bib)&&(e.bib=e.bib.replace('<div class="csl-entry">','<div class="csl-entry">'+r.zpForceNumsCount+". "),r.zpForceNumsCount++),a+=e.bib,!0==r.zpShowAbstracts&&e.data.hasOwnProperty("abstractNote")&&e.data.abstractNote.length>0&&(a+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+e.data.abstractNote+"</p>\n"),!0==r.zpShowTags&&e.data.hasOwnProperty("tags")&&e.data.tags.length>0&&(a+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ",jQuery.each(e.data.tags,function(t,i){a+="<span class='tag'>"+i.tag+"</span>",t!=e.data.tags.length-1&&(a+="<span class='separator'>,</span> ")}),a+="</p>\n"),a+="</div>\n",!0==r.zpShowNotes&&e.hasOwnProperty("notes")&&(d+=e.notes),i.length>0&&!0===o?i.replaceWith(jQuery(a)):c+=a}),!1===o&&jQuery("#"+s.instance+" .zp-List").append(c),!0==r.zpShowNotes&&d.length>0&&(d="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+d,d+="</ol>\n</div><!-- .zp-Citation-Notes -->\n\n",jQuery("#"+s.instance).append(d)),jQuery("#"+s.instance+" .zp-List .csl-left-margin").length>0&&jQuery(".ZP_STYLE",p).text().trim().length>0&&"american-antiquity"!=jQuery(".ZP_STYLE",p).text().trim()&&(r.zpForceNumsCount=1,jQuery("#"+s.instance+" .zp-List .csl-left-margin").each(function(t,e){var a=jQuery(e).text();a=a.replace(a.match(/\d+/)[0],r.zpForceNumsCount),jQuery(e).text(a),r.zpForceNumsCount++})),i(p,s,r),!1!=s.meta.request_next&&"false"!=s.meta.request_next?a(s.meta.request_next,s.meta.request_last,p,r,o):(jQuery("#"+s.instance+" .zp-List").removeClass("loading"),jQuery("#"+s.instance+" .zp-List").hasClass("updating")?t[r.zpBibIndex]&&t[r.zpBibIndex].length>0&&t[r.zpBibIndex][t[r.zpBibIndex].length-1]!=r.zpCollectionId?(r.zpCollectionId=t[r.zpBibIndex][t[r.zpBibIndex].indexOf(r.zpCollectionId)+1],jQuery("#"+s.instance+" .zp-List").removeClass("updating"),a(0,0,p,r,!1)):(console.log("zp: done + reformat if needed"),i(p,s,r)):a(0,0,p,r,!0))}else console.log("zp: done"),!0===o&&(jQuery("#"+p.attr("id")+" .zp-List").removeClass("loading"),0==jQuery("#"+p.attr("id")+" .zp-List .zp-Entry").length&&jQuery("#"+p.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n"))},error:function(t){console.log("Zotpress via WP AJAX Error: ",t)}})}function i(t,e,a){var i,n,s,p,r=jQuery(".ZP_SORTBY",t).text(),o=jQuery(".ZP_ORDER",t).text(),l="data-zp-author-date";if("date"==r&&(l="data-zp-date-author"),i=e,n=r,s=l,p=o,-1!==["author","date"].indexOf(n)&&0==jQuery("#"+i.instance+" .zp-List .csl-left-margin").length&&jQuery("#"+i.instance+" .zp-List div.zp-Entry").sort(function(t,e){var a=t.getAttribute(s).toLowerCase(),i=e.getAttribute(s).toLowerCase();if(a>i)return"asc"==p?1:-1;return a<i?"asc"==p?-1:1:0}).detach().appendTo("#"+i.instance+" .zp-List"),!1!==a.zpTitle){var z={};jQuery("#"+e.instance+" .zp-List div.zp-Entry").each(function(t,e){var i=jQuery(e).data("zp-"+a.zpTitle);!1===z.hasOwnProperty(i)&&(z[i]=[]),z[i].push(jQuery(e).attr("id"))});var c=Object.getOwnPropertyNames(z);if("itemtype"==a.zpTitle){var d=["book","bookSection","journalArticle","conferencePaper","thesis","report","encyclopediaArticle","newspaperArticle","magazineArticle","presentation","interview","dictionaryEntry","document","manuscript","patent","map","blogPost","webpage","artwork","film","audioRecording","statute","bill","case","hearing","forumPost","letter","email","instantMessage","software","podcast","radioBroadcast","tvBroadcast","videoRecording","attachment","note"];d.slice(0).forEach(function(t,e){-1==c.indexOf(t)&&d.splice(d.indexOf(t),1)}),c=d}else"asc"==o?c.sort(function(t,e){return t-e}):c.sort(function(t,e){return e-t});c.forEach(function(e,i){var n=e;if("itemtype"==a.zpTitle){if(null!==n.match(/[A-Z]/)){var s=n.match(/[A-Z]/).index;n=n.substr(0,s)+" "+n.substr(s)}n=n.charAt(0).toUpperCase()+n.slice(1)}"0000"==n&&(n="No date"),a.zpTitle,0==jQuery("#"+t.attr("id")+" .zp-List h3[rel='"+e+"']").length&&jQuery("#"+t.attr("id")+" .zp-List").append("<h3 rel='"+e+"'>"+n+"</h3>\n"),"year"==a.zpTitle&&"asc"==o?z[e].reverse():"itemtype"==a.zpTitle&&"date"==r&&z[e].reverse(),z[e].forEach(function(a,i){jQuery("#"+t.attr("id")+" #"+a).insertAfter(jQuery("#"+t.attr("id")+" .zp-List h3[rel='"+e+"']"))})})}}});